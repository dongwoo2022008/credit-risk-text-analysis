%%{init: {'theme':'base', 'themeVariables': { 'primaryColor':'#fff','primaryTextColor':'#000','primaryBorderColor':'#000','lineColor':'#000'}}}%%
flowchart LR
    %% Input Phase
    P0["① Phase 0<br/>Structured Only"]
    P1["② Phase 1<br/>Text Only"]
    
    %% Main Processing Flow
    P2["③ Phase 2<br/>Structured + Text"]
    P3["④ Phase 3<br/>Hyperparameter<br/>Tuning"]
    P4["⑤ Phase 4<br/>Ensemble"]
    P5["⑥ Phase 5<br/>Conditional Text<br/>Addition"]
    
    %% Text Embedding Methods Group
    subgraph SG["Text Embedding Methods"]
        direction TB
        S1["Stage 1<br/>tf-idf"]
        S2["Stage 2<br/>subword"]
        S3["Stage 3<br/>MINiLM"]
        S4["Stage 4<br/>KoSimCSE"]
    end
    
    %% Phase 4 Sub-techniques
    subgraph P4G["Phase 4 Techniques"]
        direction TB
        P4_1["Voting H"]
        P4_2["Voting W"]
        P4_3["Blanding"]
        P4_4["Stacking"]
    end
    
    %% Phase 5 Sub-techniques
    subgraph P5G["Phase 5 Techniques"]
        direction TB
        P5_1["Boundary<br/>Effect"]
        P5_2["Error<br/>Cases"]
        P5_3["Outlier"]
        P5_4["Text<br/>Length"]
    end
    
    %% Main Flow
    P0 --> P2
    P1 --> P2
    P2 -->|Integrate| P3
    P3 -->|Optimize| P4
    P4 -->|Conditional| P5
    
    %% Stage Connections
    P1 -.->|4 Methods| SG
    P2 -.->|4 Methods| SG
    
    %% Sub-technique Connections
    P4 -.-> P4G
    P5 -.-> P5G
    
    %% Styles
    classDef inputStyle fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#000
    classDef processStyle fill:#f5f5f5,stroke:#424242,stroke-width:2px,color:#000
    classDef stageStyle fill:#fff9c4,stroke:#f57f17,stroke-width:2px,color:#000
    classDef subStyle fill:#e8f5e9,stroke:#388e3c,stroke-width:1.5px,color:#000
    
    class P0,P1 inputStyle
    class P2,P3,P4,P5 processStyle
    class S1,S2,S3,S4 stageStyle
    class P4_1,P4_2,P4_3,P4_4,P5_1,P5_2,P5_3,P5_4 subStyle
    
    style SG fill:#fffde7,stroke:#f57f17,stroke-width:2px,stroke-dasharray: 5 5
    style P4G fill:#f1f8e9,stroke:#388e3c,stroke-width:2px,stroke-dasharray: 5 5
    style P5G fill:#f1f8e9,stroke:#388e3c,stroke-width:2px,stroke-dasharray: 5 5
